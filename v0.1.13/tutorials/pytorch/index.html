<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Function fitting with PyTorch · MathOptAI.jl</title><meta name="title" content="Function fitting with PyTorch · MathOptAI.jl"/><meta property="og:title" content="Function fitting with PyTorch · MathOptAI.jl"/><meta property="twitter:title" content="Function fitting with PyTorch · MathOptAI.jl"/><meta name="description" content="Documentation for MathOptAI.jl."/><meta property="og:description" content="Documentation for MathOptAI.jl."/><meta property="twitter:description" content="Documentation for MathOptAI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MathOptAI.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">MathOptAI.jl</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/predictors/">Predictors</a></li><li><a class="tocitem" href="../../manual/AbstractGPs/">AbstractGPs.jl</a></li><li><a class="tocitem" href="../../manual/DecisionTree/">DecisionTree.jl</a></li><li><a class="tocitem" href="../../manual/EvoTrees/">EvoTrees.jl</a></li><li><a class="tocitem" href="../../manual/Flux/">Flux.jl</a></li><li><a class="tocitem" href="../../manual/GLM/">GLM.jl</a></li><li><a class="tocitem" href="../../manual/Lux/">Lux.jl</a></li><li><a class="tocitem" href="../../manual/PyTorch/">PyTorch</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../student_enrollment/">Logistic regression with GLM.jl</a></li><li><a class="tocitem" href="../decision_trees/">Classification problems with DecisionTree.jl</a></li><li><a class="tocitem" href="../mnist/">Adversarial machine learning with Flux.jl</a></li><li><a class="tocitem" href="../mnist_lux/">Adversarial machine learning with Lux.jl</a></li><li class="is-active"><a class="tocitem" href>Function fitting with PyTorch</a><ul class="internal"><li><a class="tocitem" href="#Python-integration"><span>Python integration</span></a></li><li><a class="tocitem" href="#Required-packages"><span>Required packages</span></a></li><li><a class="tocitem" href="#Training-a-model"><span>Training a model</span></a></li><li><a class="tocitem" href="#JuMP-model"><span>JuMP model</span></a></li></ul></li><li><a class="tocitem" href="../gaussian/">Function fitting with AbstractGPs</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../developers/design_principles/">Design principles</a></li></ul></li><li><a class="tocitem" href="../../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Function fitting with PyTorch</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Function fitting with PyTorch</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lanl-ansi/MathOptAI.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/lanl-ansi/MathOptAI.jl/blob/main/docs/src/tutorials/pytorch.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Function-fitting-with-PyTorch"><a class="docs-heading-anchor" href="#Function-fitting-with-PyTorch">Function fitting with PyTorch</a><a id="Function-fitting-with-PyTorch-1"></a><a class="docs-heading-anchor-permalink" href="#Function-fitting-with-PyTorch" title="Permalink"></a></h1><p>The purpose of this tutorial is to explain how to embed a neural network model from <a href="https://pytorch.org">PyTorch</a> into JuMP.</p><h2 id="Python-integration"><a class="docs-heading-anchor" href="#Python-integration">Python integration</a><a id="Python-integration-1"></a><a class="docs-heading-anchor-permalink" href="#Python-integration" title="Permalink"></a></h2><p>MathOptAI uses <a href="https://github.com/JuliaPy/PythonCall.jl">PythonCall.jl</a> to call from Julia into Python.</p><p>To use <a href="../../api/#PytorchModel"><code>PytorchModel</code></a> your code must load the <code>PythonCall</code> package:</p><pre><code class="language-julia hljs">import PythonCall</code></pre><p>PythonCall uses <a href="https://github.com/JuliaPy/CondaPkg.jl">CondaPkg.jl</a> to manage Python dependencies. See <a href="https://github.com/JuliaPy/CondaPkg.jl">CondaPkg.jl</a> for more control over how to link Julia to an existing Python environment. For example, if you have an existing Python installation (with PyTorch installed), and it is available in the current Conda environment, do:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_CONDAPKG_BACKEND&quot;] = &quot;Current&quot;
import PythonCall</code></pre><p>If the Python installation can be found on the path and it is not in a Conda environment, do:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_CONDAPKG_BACKEND&quot;] = &quot;Null&quot;
import PythonCall</code></pre><p>If <code>python</code> is not on your path, you may additionally need to set <code>JULIA_PYTHONCALL_EXE</code>, for example, do:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_PYTHONCALL_EXE&quot;] = &quot;python3&quot;
ENV[&quot;JULIA_CONDAPKG_BACKEND&quot;] = &quot;Null&quot;
import PythonCall</code></pre><h2 id="Required-packages"><a class="docs-heading-anchor" href="#Required-packages">Required packages</a><a id="Required-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Required-packages" title="Permalink"></a></h2><p>This tutorial requires the following packages</p><pre><code class="language-julia hljs">using JuMP
using Test
import Ipopt
import MathOptAI
import Plots
import PythonCall</code></pre><h2 id="Training-a-model"><a class="docs-heading-anchor" href="#Training-a-model">Training a model</a><a id="Training-a-model-1"></a><a class="docs-heading-anchor-permalink" href="#Training-a-model" title="Permalink"></a></h2><p>The following script builds and trains a simple neural network in PyTorch. For simplicity, we do not evaluate out-of-sample test performance, or use a batched data loader. In general, you should train your model in Python, and then use <code>torch.save(model, filename)</code> to save it to a <code>.pt</code> file for later use in Julia.</p><p>The model is unimportant, but for this example, we are trying to fit noisy observations of the function <span>$f(x) = x^2 - 2x$</span>.</p><p>In Python, we ran:</p><pre><code class="language-python hljs">#!/usr/bin/python3
import torch
model = torch.nn.Sequential(
    torch.nn.Linear(1, 16),
    torch.nn.ReLU(),
    torch.nn.Linear(16, 1),
)

n = 1024
x = torch.arange(-2, 2 + 4 / (n - 1), 4 / (n - 1)).reshape(n, 1)
loss_fn = torch.nn.MSELoss()
optimizer = torch.optim.Adam(model.parameters(), lr=0.01)
for epoch in range(100):
    optimizer.zero_grad()
    N = torch.normal(torch.zeros(n, 1), torch.ones(n, 1))
    y = x ** 2 -2 * x + 0.1 * N
    loss = loss_fn(model(x), y)
    loss.backward()
    optimizer.step()

torch.save(model, &quot;model.pt&quot;)</code></pre><h2 id="JuMP-model"><a class="docs-heading-anchor" href="#JuMP-model">JuMP model</a><a id="JuMP-model-1"></a><a class="docs-heading-anchor-permalink" href="#JuMP-model" title="Permalink"></a></h2><p>Our goal for this JuMP model is to load the Neural Network from PyTorch into the objective function, and then minimize the objective for different fixed values of <code>x</code> to recreate the function that the Neural Network has learned to approximate.</p><p>First, create a JuMP model:</p><pre><code class="language-julia hljs">model = Model(Ipopt.Optimizer)
set_silent(model)
@variable(model, x)</code></pre><p class="math-container">\[ x \]</p><p>Then, load the model from PyTorch using <a href="../../api/#MathOptAI.PytorchModel"><code>MathOptAI.PytorchModel</code></a>:</p><pre><code class="language-julia hljs">predictor = MathOptAI.PytorchModel(joinpath(@__DIR__, &quot;model.pt&quot;))
y, _ = MathOptAI.add_predictor(model, predictor, [x])
@objective(model, Min, only(y))</code></pre><p class="math-container">\[ moai\_Affine_{1} \]</p><p>Now, visualize the fitted function <code>y = predictor(x)</code> by repeatedly solving the optimization problem for different fixed values of <code>x</code>:</p><pre><code class="language-julia hljs">X, Y = -2:0.1:2, Float64[]
@constraint(model, c, x == 0.0)
for xi in X
    set_normalized_rhs(c, xi)
    optimize!(model)
    @test is_solved_and_feasible(model)
    push!(Y, objective_value(model))
end
Plots.plot(x -&gt; x^2 - 2x, X; label = &quot;Truth&quot;, linestype = :dot)
Plots.plot!(X, Y; label = &quot;Fitted&quot;)</code></pre><img src="c6d69833.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mnist_lux/">« Adversarial machine learning with Lux.jl</a><a class="docs-footer-nextpage" href="../gaussian/">Function fitting with AbstractGPs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Monday 7 July 2025 23:08">Monday 7 July 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
