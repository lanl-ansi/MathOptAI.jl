<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PyTorch · MathOptAI.jl</title><meta name="title" content="PyTorch · MathOptAI.jl"/><meta property="og:title" content="PyTorch · MathOptAI.jl"/><meta property="twitter:title" content="PyTorch · MathOptAI.jl"/><meta name="description" content="Documentation for MathOptAI.jl."/><meta property="og:description" content="Documentation for MathOptAI.jl."/><meta property="twitter:description" content="Documentation for MathOptAI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MathOptAI.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">MathOptAI.jl</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../predictors/">Predictors</a></li><li><a class="tocitem" href="../AbstractGPs/">AbstractGPs.jl</a></li><li><a class="tocitem" href="../DecisionTree/">DecisionTree.jl</a></li><li><a class="tocitem" href="../EvoTrees/">EvoTrees.jl</a></li><li><a class="tocitem" href="../Flux/">Flux.jl</a></li><li><a class="tocitem" href="../GLM/">GLM.jl</a></li><li><a class="tocitem" href="../Lux/">Lux.jl</a></li><li class="is-active"><a class="tocitem" href>PyTorch</a><ul class="internal"><li><a class="tocitem" href="#Supported-layers"><span>Supported layers</span></a></li><li><a class="tocitem" href="#File-format"><span>File format</span></a></li><li><a class="tocitem" href="#Python-integration"><span>Python integration</span></a></li><li><a class="tocitem" href="#Basic-example"><span>Basic example</span></a></li><li><a class="tocitem" href="#Reduced-space"><span>Reduced-space</span></a></li><li><a class="tocitem" href="#Gray-box"><span>Gray-box</span></a></li><li><a class="tocitem" href="#Change-how-layers-are-formulated"><span>Change how layers are formulated</span></a></li><li><a class="tocitem" href="#Custom-layers"><span>Custom layers</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/student_enrollment/">Logistic regression with GLM.jl</a></li><li><a class="tocitem" href="../../tutorials/decision_trees/">Classification problems with DecisionTree.jl</a></li><li><a class="tocitem" href="../../tutorials/mnist/">Adversarial machine learning with Flux.jl</a></li><li><a class="tocitem" href="../../tutorials/mnist_lux/">Adversarial machine learning with Lux.jl</a></li><li><a class="tocitem" href="../../tutorials/pytorch/">Function fitting with PyTorch</a></li><li><a class="tocitem" href="../../tutorials/gaussian/">Function fitting with AbstractGPs</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../developers/design_principles/">Design principles</a></li></ul></li><li><a class="tocitem" href="../../api/">API Reference</a></li><li><a class="tocitem" href="../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>PyTorch</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>PyTorch</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lanl-ansi/MathOptAI.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/lanl-ansi/MathOptAI.jl/blob/main/docs/src/manual/PyTorch.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="PyTorch"><a class="docs-heading-anchor" href="#PyTorch">PyTorch</a><a id="PyTorch-1"></a><a class="docs-heading-anchor-permalink" href="#PyTorch" title="Permalink"></a></h1><p><a href="https://pytorch.org">PyTorch</a> is a library for machine learning in Python.</p><p>The upstream documentation is available at <a href="https://pytorch.org/docs/stable/">https://pytorch.org/docs/stable/</a>.</p><h2 id="Supported-layers"><a class="docs-heading-anchor" href="#Supported-layers">Supported layers</a><a id="Supported-layers-1"></a><a class="docs-heading-anchor-permalink" href="#Supported-layers" title="Permalink"></a></h2><p>MathOptAI supports embedding a PyTorch models into JuMP if it is a <a href="https://pytorch.org/docs/stable/generated/torch.nn.Sequential.html"><code>nn.Sequential</code></a> composed of:</p><ul><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.AvgPool2d.html"><code>nn.AvgPool2d</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Conv2d.html"><code>nn.Conv2d</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Flatten.html"><code>nn.Flatten</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.GELU.html"><code>nn.GELU</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.LeakyReLU.html"><code>nn.LeakyReLU</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html"><code>nn.Linear</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.MaxPool2d.html"><code>nn.MaxPool2d</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.ReLU.html"><code>nn.ReLU</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Sigmoid.html"><code>nn.Sigmoid</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Softmax.html"><code>nn.Softmax</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Softplus.html"><code>nn.Softplus</code></a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.nn.Tanhh.html"><code>nn.Tanh</code></a></li></ul><h2 id="File-format"><a class="docs-heading-anchor" href="#File-format">File format</a><a id="File-format-1"></a><a class="docs-heading-anchor-permalink" href="#File-format" title="Permalink"></a></h2><p>Use <a href="https://pytorch.org/docs/stable/generated/torch.save.html"><code>torch.save</code></a> to save a trained PyTorch model to a <code>.pt</code> file:</p><pre><code class="language-python hljs">#!/usr/bin/python3
import torch
model = torch.nn.Sequential(
    torch.nn.Linear(1, 2),
    torch.nn.ReLU(),
    torch.nn.Linear(2, 1),
)
torch.save(model, &quot;saved_pytorch_model.pt&quot;)</code></pre><h2 id="Python-integration"><a class="docs-heading-anchor" href="#Python-integration">Python integration</a><a id="Python-integration-1"></a><a class="docs-heading-anchor-permalink" href="#Python-integration" title="Permalink"></a></h2><p>MathOptAI uses <a href="https://github.com/JuliaPy/PythonCall.jl">PythonCall.jl</a> to call from Julia into Python.</p><p>To use <a href="../../api/#PytorchModel"><code>PytorchModel</code></a> your code must load the <code>PythonCall</code> package:</p><pre><code class="language-julia hljs">import PythonCall</code></pre><p>PythonCall uses <a href="https://github.com/JuliaPy/CondaPkg.jl">CondaPkg.jl</a> to manage Python dependencies. See <a href="https://github.com/JuliaPy/CondaPkg.jl">CondaPkg.jl</a> for more control over how to link Julia to an existing Python environment. For example, if you have an existing Python installation (with PyTorch installed), and it is available in the current Conda environment, do:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_CONDAPKG_BACKEND&quot;] = &quot;Current&quot;
import PythonCall</code></pre><p>If the Python installation can be found on the path and it is not in a Conda environment, do:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_CONDAPKG_BACKEND&quot;] = &quot;Null&quot;
import PythonCall</code></pre><p>If <code>python</code> is not on your path, you may additionally need to set <code>JULIA_PYTHONCALL_EXE</code>, for example, do:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_PYTHONCALL_EXE&quot;] = &quot;python3&quot;
ENV[&quot;JULIA_CONDAPKG_BACKEND&quot;] = &quot;Null&quot;
import PythonCall</code></pre><h2 id="Basic-example"><a class="docs-heading-anchor" href="#Basic-example">Basic example</a><a id="Basic-example-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-example" title="Permalink"></a></h2><p>Use <a href="../../api/#MathOptAI.add_predictor"><code>MathOptAI.add_predictor</code></a> to embed a PyTorch model into a JuMP model:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP, MathOptAI, PythonCall</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(model, x[1:1]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; predictor = MathOptAI.PytorchModel(&quot;saved_pytorch_model.pt&quot;);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y, formulation = MathOptAI.add_predictor(model, predictor, x);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{JuMP.VariableRef}:
 moai_Affine[1]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; formulation</code><code class="nohighlight hljs ansi" style="display:block;">Affine(A, b) [input: 1, output: 2]
├ variables [2]
│ ├ moai_Affine[1]
│ └ moai_Affine[2]
└ constraints [2]
  ├ 0.7473132610321045 x[1] - moai_Affine[1] = 0.27370238304138184
  └ -0.8237636089324951 x[1] - moai_Affine[2] = 0.08490216732025146
MathOptAI.ReLU()
├ variables [2]
│ ├ moai_ReLU[1]
│ └ moai_ReLU[2]
└ constraints [4]
  ├ moai_ReLU[1] ≥ 0
  ├ moai_ReLU[1] - max(0, moai_Affine[1]) = 0
  ├ moai_ReLU[2] ≥ 0
  └ moai_ReLU[2] - max(0, moai_Affine[2]) = 0
Affine(A, b) [input: 2, output: 1]
├ variables [1]
│ └ moai_Affine[1]
└ constraints [1]
  └ -0.4644489884376526 moai_ReLU[1] + 0.5382549166679382 moai_ReLU[2] - moai_Affine[1] = 0.5698285102844238</code></pre><h2 id="Reduced-space"><a class="docs-heading-anchor" href="#Reduced-space">Reduced-space</a><a id="Reduced-space-1"></a><a class="docs-heading-anchor-permalink" href="#Reduced-space" title="Permalink"></a></h2><p>Use the <code>reduced_space = true</code> keyword to formulate a reduced-space model:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP, MathOptAI, PythonCall</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(model, x[1:1]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; predictor = MathOptAI.PytorchModel(&quot;saved_pytorch_model.pt&quot;);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y, formulation =
           MathOptAI.add_predictor(model, predictor, x; reduced_space = true);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{JuMP.NonlinearExpr}:
 ((+(0) + (-0.4644489884376526 * max(0, 0.7473132610321045 x[1] - 0.27370238304138184))) + (0.5382549166679382 * max(0, -0.8237636089324951 x[1] - 0.08490216732025146))) + -0.5698285102844238</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; formulation</code><code class="nohighlight hljs ansi" style="display:block;">ReducedSpace(Affine(A, b) [input: 1, output: 2])
├ variables [0]
└ constraints [0]
ReducedSpace(MathOptAI.ReLU())
├ variables [0]
└ constraints [0]
ReducedSpace(Affine(A, b) [input: 2, output: 1])
├ variables [0]
└ constraints [0]</code></pre><h2 id="Gray-box"><a class="docs-heading-anchor" href="#Gray-box">Gray-box</a><a id="Gray-box-1"></a><a class="docs-heading-anchor-permalink" href="#Gray-box" title="Permalink"></a></h2><p>Use the <code>gray_box = true</code> keyword to embed the network as a vector nonlinear operator:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP, MathOptAI, PythonCall</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(model, x[1:1]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; predictor = MathOptAI.PytorchModel(&quot;saved_pytorch_model.pt&quot;);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y, formulation =
           MathOptAI.add_predictor(model, predictor, x; gray_box = true);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{JuMP.VariableRef}:
 moai_Pytorch[1]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; formulation</code><code class="nohighlight hljs ansi" style="display:block;">MathOptAI.GrayBox{MathOptAI.PytorchModel}(MathOptAI.PytorchModel(&quot;saved_pytorch_model.pt&quot;), &quot;cpu&quot;, true)
├ variables [1]
│ └ moai_Pytorch[1]
└ constraints [1]
  └ [x[1], moai_Pytorch[1]] ∈ VectorNonlinearOracle{Float64}(;
    dimension = 2,
    l = [0.0],
    u = [0.0],
    ...,
)</code></pre><h2 id="Change-how-layers-are-formulated"><a class="docs-heading-anchor" href="#Change-how-layers-are-formulated">Change how layers are formulated</a><a id="Change-how-layers-are-formulated-1"></a><a class="docs-heading-anchor-permalink" href="#Change-how-layers-are-formulated" title="Permalink"></a></h2><p>Pass a dictionary to the <code>config</code> keyword that maps the <code>Symbol</code> name of each PyTorch layer to a MathOptAI predictor:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP, MathOptAI, PythonCall</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(model, x[1:1]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; predictor = MathOptAI.PytorchModel(&quot;saved_pytorch_model.pt&quot;);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y, formulation = MathOptAI.add_predictor(
           model,
           predictor,
           x;
           config = Dict(:ReLU =&gt; MathOptAI.ReLUSOS1),
       );</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{JuMP.VariableRef}:
 moai_Affine[1]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; formulation</code><code class="nohighlight hljs ansi" style="display:block;">Affine(A, b) [input: 1, output: 2]
├ variables [2]
│ ├ moai_Affine[1]
│ └ moai_Affine[2]
└ constraints [2]
  ├ 0.7473132610321045 x[1] - moai_Affine[1] = 0.27370238304138184
  └ -0.8237636089324951 x[1] - moai_Affine[2] = 0.08490216732025146
MathOptAI.ReLUSOS1()
├ variables [4]
│ ├ moai_ReLU[1]
│ ├ moai_ReLU[2]
│ ├ moai_z[1]
│ └ moai_z[2]
└ constraints [8]
  ├ moai_ReLU[1] ≥ 0
  ├ moai_z[1] ≥ 0
  ├ moai_Affine[1] - moai_ReLU[1] + moai_z[1] = 0
  ├ [moai_ReLU[1], moai_z[1]] ∈ MathOptInterface.SOS1{Float64}([1.0, 2.0])
  ├ moai_ReLU[2] ≥ 0
  ├ moai_z[2] ≥ 0
  ├ moai_Affine[2] - moai_ReLU[2] + moai_z[2] = 0
  └ [moai_ReLU[2], moai_z[2]] ∈ MathOptInterface.SOS1{Float64}([1.0, 2.0])
Affine(A, b) [input: 2, output: 1]
├ variables [1]
│ └ moai_Affine[1]
└ constraints [1]
  └ -0.4644489884376526 moai_ReLU[1] + 0.5382549166679382 moai_ReLU[2] - moai_Affine[1] = 0.5698285102844238</code></pre><h2 id="Custom-layers"><a class="docs-heading-anchor" href="#Custom-layers">Custom layers</a><a id="Custom-layers-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-layers" title="Permalink"></a></h2><p>If your PyTorch model contains a custom layer, define a new <a href="../../api/#AbstractPredictor"><code>AbstractPredictor</code></a> and pass a <code>config</code> dictionary that maps the Class object to a callback that builds the new predictor.</p><p>The callback must have the signature <code>(layer::PythonCall.Py; kwargs...)</code>. Valid keyword arguments are currently:</p><ul><li><code>input_size</code>: the input size of they layer</li><li><code>config</code>: the <code>config</code> dictionary, if needed to convert layers inside the custom layer</li><li><code>nn</code>: a reference to <code>torch.nn</code></li></ul><p>You must always have <code>kwargs...</code> so that future versions of MathOptAI can add new keywords in a non-breaking way.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP, PythonCall, MathOptAI</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dir = mktempdir()</code><code class="nohighlight hljs ansi" style="display:block;">&quot;/tmp/jl_xdXpeM&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; write(
           joinpath(dir, &quot;custom_model.py&quot;),
           &quot;&quot;&quot;
           import torch
           class Skip(torch.nn.Module):
               def __init__(self, inner):
                   super().__init__()
                   self.inner = inner
               def forward(self, x):
                   return self.inner(x) + x
           &quot;&quot;&quot;,
       )</code><code class="nohighlight hljs ansi" style="display:block;">186</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; filename = joinpath(dir, &quot;custom_model.pt&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;/tmp/jl_xdXpeM/custom_model.pt&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; PythonCall.@pyexec(
           (dir, filename) =&gt;
               &quot;&quot;&quot;
               import sys
               sys.path.insert(0, dir)
               import torch
               from custom_model import Skip
               inner = torch.nn.Sequential(torch.nn.Linear(3, 3), torch.nn.ReLU())
               model = Skip(inner)
               torch.save(model, filename)
               &quot;&quot;&quot; =&gt; Skip,
       )</code><code class="nohighlight hljs ansi" style="display:block;">Python: &lt;class &#39;custom_model.Skip&#39;&gt;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; struct CustomPredictor &lt;: MathOptAI.AbstractPredictor
           p::MathOptAI.Pipeline
       end</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; function MathOptAI.add_predictor(
           model::JuMP.AbstractModel,
           predictor::CustomPredictor,
           x::Vector;
           kwargs...,
       )
           y, formulation = MathOptAI.add_predictor(model, predictor.p, x; kwargs...)
           @assert length(x) == length(y)
           return y .+ x, formulation
       end</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(model, x[i in 1:3]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; predictor = MathOptAI.PytorchModel(filename)</code><code class="nohighlight hljs ansi" style="display:block;">MathOptAI.PytorchModel(&quot;/tmp/jl_xdXpeM/custom_model.pt&quot;)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; function skip_callback(layer::PythonCall.Py; input_size, kwargs...)
           return CustomPredictor(MathOptAI.build_predictor(layer.inner))
       end</code><code class="nohighlight hljs ansi" style="display:block;">skip_callback (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; config = Dict(Skip =&gt; skip_callback)</code><code class="nohighlight hljs ansi" style="display:block;">Dict{PythonCall.Py, typeof(Main.skip_callback)} with 1 entry:
  &lt;class &#39;custom_model.Skip&#39;&gt; =&gt; skip_callback</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y, formulation = MathOptAI.add_predictor(model, predictor, x; config);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y</code><code class="nohighlight hljs ansi" style="display:block;">3-element Vector{JuMP.AffExpr}:
 moai_ReLU[1] + x[1]
 moai_ReLU[2] + x[2]
 moai_ReLU[3] + x[3]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; formulation</code><code class="nohighlight hljs ansi" style="display:block;">Affine(A, b) [input: 3, output: 3]
├ variables [3]
│ ├ moai_Affine[1]
│ ├ moai_Affine[2]
│ └ moai_Affine[3]
└ constraints [3]
  ├ 0.3549134135246277 x[1] - 0.10919897258281708 x[2] - 0.3432142436504364 x[3] - moai_Affine[1] = -0.5538322329521179
  ├ -0.07363318651914597 x[1] + 0.5136020183563232 x[2] - 0.3986618220806122 x[3] - moai_Affine[2] = 0.24720238149166107
  └ 0.4314819574356079 x[1] + 0.20827646553516388 x[2] + 0.3675543963909149 x[3] - moai_Affine[3] = 0.07034359872341156
MathOptAI.ReLU()
├ variables [3]
│ ├ moai_ReLU[1]
│ ├ moai_ReLU[2]
│ └ moai_ReLU[3]
└ constraints [6]
  ├ moai_ReLU[1] ≥ 0
  ├ moai_ReLU[1] - max(0, moai_Affine[1]) = 0
  ├ moai_ReLU[2] ≥ 0
  ├ moai_ReLU[2] - max(0, moai_Affine[2]) = 0
  ├ moai_ReLU[3] ≥ 0
  └ moai_ReLU[3] - max(0, moai_Affine[3]) = 0</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Lux/">« Lux.jl</a><a class="docs-footer-nextpage" href="../../tutorials/student_enrollment/">Logistic regression with GLM.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 20 January 2026 20:33">Tuesday 20 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
